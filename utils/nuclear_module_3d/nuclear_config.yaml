# --- START OF MODIFIED FILE utils/nuclear_module_3d/nuclear_config.yaml ---
# Configuration for 3D Nuclear Segmentation

# REQUIRED: Processing mode identifier
mode: nuclei

# REQUIRED: Voxel dimensions (total physical size of each axis in microns)
# Voxel size will be calculated as (total_dimension / number_of_voxels_in_dimension)
# These values are from your nuclear_config.txt
voxel_dimensions:
  x: 471.4
  y: 471.4
  z: 126.0 # Corrected Z from your txt (was 1 in placeholder)

# --- Parameters for Step 1: Initial Segmentation ---
# Corresponds to execute_initial_segmentation method
execute_initial_segmentation_nuclei:
  parameters:
    # Parameters directly used by segment_nuclei (first pass part)
    # smooth_sigma is not in your txt as a GUI param for initial_segmentation,
    # so the strategy uses a default [0.5, 1.0, 2.0].
    # If you want it configurable for initial pass, add it here.
    min_distance:
      label: "Min Peak Distance (Initial)" # Suffix to distinguish from refine step
      type: "float" # Matched from your txt
      value: 10.0    # Matched from your txt
      min: 0.1
      max: 500.0
      step: 0.1
      tooltip: "Minimum distance between detected peaks in physical units for initial segmentation pass."
    min_size:
      label: "Min Object Size (Initial)" # Suffix to distinguish
      type: "float" # Matched from your txt (though segment_nuclei expects int, GUI can send float then strategy converts if needed, or widget ensures int)
      value: 100.0   # Matched from your txt
      min: 0.5       # Let's assume your nuclear_segmenter handles float min_size or it gets truncated.
      max: 10000.0
      step: 0.1
      tooltip: "Minimum size in voxels for an object to be kept after initial segmentation."
    # contrast_threshold_factor is for second pass, not initial.
    anisotropy_normalization_degree:
      label: "Anisotropy Norm (Initial)" # Suffix to distinguish
      type: "float" # Matched from your txt
      value: 0.0     # Matched from your txt for initial_segmentation
      min: 0.0
      max: 1.0
      step: 0.1 # Changed step to 0.1 for finer control, your txt had 1
      tooltip: "Degree of Z-axis downsampling for isotropy (0=none, 1=full) for initial pass."
    # Add smooth_sigma if you want it configurable for the initial pass:
    # smooth_sigma:
    #   label: "Smoothing Sigmas (Initial)"
    #   type: "list" # e.g., "0.5,1.0,2.0"
    #   value: [0.5, 1.0, 2.0] # Default if widget supports list directly, else string
    #   tooltip: "Gaussian smoothing sigmas for multiscale analysis (comma-separated floats)."


# --- Parameters for Step 2: Refine ROIs ---
# Corresponds to execute_refine_rois method
execute_refine_rois_nuclei:
  parameters:
    # Parameters directly used by segment_nuclei (second pass part)
    # smooth_sigma is not in your txt as a GUI param for refine_rois,
    # so the strategy uses a default. Add if configurable.
    min_distance:
      label: "Min Peak Distance (Refine)"
      type: "float"
      value: 2.5     # Matched from your txt
      min: 0.1
      max: 500.0
      step: 0.1
      tooltip: "Minimum distance between detected peaks in physical units for refinement pass."
    min_size:
      label: "Min Object Size (Refine)"
      type: "float"
      value: 200.0   # Matched from your txt
      min: 0.5
      max: 10000.0
      step: 0.1
      tooltip: "Minimum size in voxels for an object to be kept after refinement."
    contrast_threshold_factor:
      label: "Contrast Threshold Factor"
      type: "float"
      value: 1.5     # Matched from your txt
      min: 0.0
      max: 10.0
      step: 0.1
      tooltip: "Factor to adjust threshold for detecting high-contrast regions for splitting."
    anisotropy_normalization_degree:
      label: "Anisotropy Norm (Refine)"
      type: "float"
      value: 1.0     # Matched from your txt
      min: 0.0
      max: 1.0
      step: 0.1 # Changed step to 0.1
      tooltip: "Degree of Z-axis downsampling for isotropy (0=none, 1=full) for refinement pass."
    use_advanced_splitting: # This parameter is used by the strategy method itself
      label: "Use Advanced Splitting"
      type: "bool"
      value: True
      tooltip: "Enable advanced methods (LoG, graph-cut) for splitting difficult clusters in the refinement pass."
    # Add smooth_sigma if you want it configurable for the refinement pass:
    # smooth_sigma:
    #   label: "Smoothing Sigmas (Refine)"
    #   type: "list"
    #   value: [0.5, 1.0, 2.0]
    #   tooltip: "Gaussian smoothing sigmas for multiscale analysis during refinement (comma-separated floats)."


# --- Parameters for Step 3: Calculate Features ---
# Corresponds to execute_calculate_features method
# This step, as implemented in the strategy, does not take GUI parameters.
# If it did, they would be listed here.
execute_calculate_features_nuclei:
  parameters: {} # Empty, as no GUI-configurable parameters are currently used by the method.
  # If you wanted to add, for example, a switch for a specific metric:
  #   calculate_intensity_props:
  #     label: "Calculate Intensity Properties"
  #     type: "bool"
  #     value: True
  #     tooltip: "If checked, calculate intensity-based metrics for each nucleus."

# --- Optional: Saved state (this section is managed by the application, not manually edited) ---
# This section will be populated by the application when it saves the config,
# for example, with 'first_pass_params' or an adaptive 'segmentation_threshold'.
# saved_state:
#   first_pass_params:
#     anisotropy_normalization_degree: 0.0
#     smooth_sigma: [0.5, 1.0, 2.0]
#     min_distance: 10.0
#     min_size: 100.0
#     spacing: [1.0, 0.3, 0.3] # Example
#     isotropic_spacing: [1.0, 1.0, 1.0] # Example
#     downsampled_shape: [126, 157, 157] # Example
#     threshold: 85.0 # Example
#   segmentation_threshold: 123.45 # Example if you had an adaptive global threshold

# --- END OF MODIFIED FILE utils/nuclear_module_3d/nuclear_config.yaml ---